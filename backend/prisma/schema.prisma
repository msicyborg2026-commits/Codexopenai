generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Employer {
  id                 Int        @id @default(autoincrement())
  tipoSoggetto       String
  nome               String
  cognomeRagione     String
  codiceFiscale      String     @unique
  email              String
  telefono           String
  indirizzoLavoro    String
  preferenzeNotifica String
  contracts          Contract[]
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
}

model Worker {
  id                Int        @id @default(autoincrement())
  nome              String
  cognome           String
  codiceFiscale     String     @unique
  dataNascita       DateTime
  email             String
  telefono          String
  documentiIdentita String
  iban              String?
  contracts         Contract[]
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
}

model Contract {
  id                        Int                @id @default(autoincrement())
  employerId                Int
  workerId                  Int
  status                    ContractStatus     @default(DRAFT)
  contractType              ContractType
  level                     String
  convivente                Boolean
  startDate                 DateTime
  endDate                   DateTime?
  probationMonths           Int?
  weeklyHours               Decimal
  monHours                  Decimal?
  tueHours                  Decimal?
  wedHours                  Decimal?
  thuHours                  Decimal?
  friHours                  Decimal?
  satHours                  Decimal?
  sunHours                  Decimal?
  payType                   PayType
  baseSalary                Decimal
  superminimo               Decimal?
  foodAllowance             Decimal?
  accommodationAllowance    Decimal?
  thirteenth                Boolean            @default(true)
  tfrAccrualRate            Decimal?
  calculatedGrossMonthly    Decimal?
  calculatedInps            Decimal?
  calculatedTotalCost       Decimal?
  notes                     String?
  employer                  Employer           @relation(fields: [employerId], references: [id])
  worker                    Worker             @relation(fields: [workerId], references: [id])
  attendances               Attendance[]
  attendanceDays            AttendanceDay[]
  workSchedule              WorkSchedule?
  createdAt                 DateTime           @default(now())
  updatedAt                 DateTime           @updatedAt
}

model WorkSchedule {
  id         Int      @id @default(autoincrement())
  contractId Int      @unique
  monMinutes Int      @default(0)
  tueMinutes Int      @default(0)
  wedMinutes Int      @default(0)
  thuMinutes Int      @default(0)
  friMinutes Int      @default(0)
  satMinutes Int      @default(0)
  sunMinutes Int      @default(0)
  contract   Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Attendance {
  id               Int      @id @default(autoincrement())
  contractId       Int
  data             DateTime
  oreOrdinarie     Float
  oreStraordinario Float
  causale          String
  note             String?
  validatoFlag     Boolean  @default(false)
  contract         Contract @relation(fields: [contractId], references: [id])
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@unique([contractId, data])
}

model AttendanceDay {
  id            Int      @id @default(autoincrement())
  contractId    Int
  date          DateTime
  workedMinutes Int      @default(0)
  note          String?
  contract      Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([contractId, date])
}

enum ContractStatus {
  DRAFT
  ACTIVE
  CLOSED
}

enum ContractType {
  COLF
  BADANTE_CONVIVENTE
  BADANTE_NON_CONVIVENTE
}

enum PayType {
  HOURLY
  MONTHLY
}
